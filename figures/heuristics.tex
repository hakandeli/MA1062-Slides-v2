\tikzstyle{netnode} = [circle, 
					   minimum width = 0.15cm, 
					   minimum height = 0.15cm, 
					   text = black!100, 
					   align=center, 
					   line width = 1, 
					   inner sep = 0.3mm, 
					   shading=radial, 
					   inner color = sapphiremacchiato!50, 
					   outer color = sapphiremacchiato!100]

\tikzstyle{netnodebig} = [circle, 
					   minimum width = 0.25cm, 
					   minimum height = 0.25cm, 
					   text = black!100, 
					   align=center, 
					   line width = 1, 
					   inner sep = 0.5mm, 
					   shading=radial, 
					   inner color = sapphiremacchiato!50, 
					   outer color = sapphiremacchiato!100]

\tikzstyle{edge}=[> = stealth, line width = 0.2pt, shorten <= 0mm, shorten >= 0mm]


\newcommand{\slotheight}{1.6cm}
\newcommand{\slotwidth}{1.5mm}
\newcommand{\numchannels}{10}
\newcommand{\fsperchannel}{5}
\newcommand{\lw}{1pt}

\tikzstyle{slot} = [draw = black,
					minimum width = \slotwidth,
				    minimum height = \slotheight, 
					text = black!100,
					anchor = west,
					line width = \lw,
					inner sep = 0mm]

    
\begin{tikzpicture}

    %background rectangles
    \node[rectangle, fill = IKRBlue!20, minimum width = 14.7cm, minimum height = 6.5cm, rounded corners = 5pt, anchor = north west, visible on = <1->] at (0,0) {};
    \node[rectangle, fill = white, minimum width = 5.3cm, minimum height = 5cm, rounded corners = 5pt, anchor = north west, visible on = <2->] at (0.5,-0.8) {};
    \node[rectangle, fill = white, minimum width = 8cm, minimum height = 5cm, rounded corners = 5pt, anchor = north west, visible on = <4->] at (6.2,-0.8) {};

    %text
    \foreach \heur/\v in {  FF/6,
                            LF/7,
                            BFF/8,
                            BFL/9,
                            WFF/10,
                            WFL/11
                         } \node[anchor = west, visible on = <\v>] at (0.1, -0.4) {Policy $\pi_{\text{KSP-\heur}}$};
    \node[anchor = center, align = center, visible on = <3->] at (3.1, -6.15) {$K$-shortest paths (KSPs)};
    \node[anchor = center, align = center, visible on = <4->] at (10.2, -6.15) {heuristic slot selection};

    %layer42
    \begin{scope}[x=0.8cm, y=0.7cm, shift={(3.15cm, -2.1cm)}]
    
        %vanilla
        \node[netnode, inner color = red!20, outer color = red!70, visible on = <2->] (nA) at (-0.53, 1.29) {\footnotesize A};
        \node[netnode, visible on = <2->] (nB) at (-0.35, 0.21) {\footnotesize B};
        \node[netnode, visible on = <2->] (nC) at (-1.39, -0.16) {\footnotesize C};
        \node[netnode, visible on = <2->] (nD) at (0.26, -0.68) {\footnotesize D};
        \node[netnode, inner color = red!20, outer color = red!70, visible on = <2->] (nE) at (1.29, -0.76) {\footnotesize E};
        \node[netnode, visible on = <2->] (nF) at (0.72, 0.1) {\footnotesize F};
        
        \draw[edge, <->, visible on = <2-3>] (nA) -- (nB); 
        \draw[edge, <->, visible on = <2->] (nB) -- (nC);
        \draw[edge, <->, visible on = <2-3>] (nB) -- (nF);
        \draw[edge, <->, visible on = <2->] (nB) -- (nD);
        \draw[edge, <->, visible on = <2->] (nD) -- (nF);
        \draw[edge, <->, visible on = <2->] (nD) -- (nE);
        \draw[edge, <->, visible on = <2-3>] (nE) -- (nF);  

        \draw[edge, color = red, ->, visible on = <4->] (nA) -- (nB); 
        \draw[edge, color = red, ->, visible on = <4->] (nB) -- (nF); 
        \draw[edge, color = red, ->, visible on = <4->] (nF) -- (nE); 
        
    \end{scope}

    %ksps

    \begin{scope}[x=0.9cm, y= 0.6cm, shift={(-0.2cm,-1cm)}]
        \foreach \x/\y/\lbl/\i in { 1.5/-4/{1.}/0, 2/-4/A/1, 3/-4/B/2, 4/-4/F/3, 5/-4/E/4,%
                                    1.5/-5/{2.}/0, 2/-5/A/5, 3/-5/B/6, 4/-5/D/7, 5/-5/E/8,
                                    1.5/-6/{3.}/0, 2/-6/A/9, 3/-6/B/10, 4/-6/F/11, 5/-6/D/12, 6/-6/E/13,
                                    1.5/-7/{4.}/0, 2/-7/A/14, 3/-7/B/15, 4/-7/D/16, 5/-7/F/17, 6/-7/E/18} {
                                    \node[visible on = <3->] (n\i) at (\x, \y) {\small \lbl};
                                }
        \foreach \x/\y/\lbl/\i in { 1.5/-4/{1.}/0, 2/-4/A/1, 3/-4/B/2, 4/-4/F/3, 5/-4/E/4} 
                                    {
                                    \node[visible on = <4->] (n\i) at (\x, \y) {\small \textcolor{red}{\lbl}};
                                    }
    \end{scope}
    \foreach \i/\j in { 1/2, 2/3, 3/4, 
                        5/6, 6/7, 7/8, 
                        9/10, 10/11, 11/12, 12/13,
                        14/15, 15/16, 16/17, 17/18}
                        \draw[->, > = Stealth, line width = 0.2pt, visible on = <3->] (n\i) -- (n\j);
    
    \foreach \i/\j in {1/2, 2/3, 3/4} \draw[->, > = Stealth, draw = red, line width = 0.2pt, visible on = <4->] (n\i) -- (n\j);


    %spectrum

    \begin{scope}[shift={(6.45cm, -4.5cm)}]
    
        % EON
    	\pgfmathtruncatemacro{\amount}{\numchannels*\fsperchannel}
    	\foreach \i in {1,...,\amount}{
    		\pgfmathtruncatemacro{\j}{\i-1}
    		\node[slot, minimum width = \slotwidth, draw = black!20, line width = 0.5*\lw, visible on = <4->] (fs\i) at (\j*\slotwidth+0.125*\lw, 0) {};
    	}
    	
    	% draw eon channels by hand	
    	\foreach \ns/\nend in  {fs1/fs3,
    						    fs13/fs18,
    	                        fs26/fs29,
    	                        fs45/fs48}{
    
    	\fill[fill=red, opacity = 0.5, visible on = <4->] (\ns.north west)++(0.25*\lw,0) -- ($(\ns.south west)+(0.25*\lw, 0.5*\lw)$) -- ($(\nend.south east) + (-0.25*\lw, 0.5*\lw)$) -- ($(\nend.north east)+(-0.25*\lw,0)$) -- cycle;
    	                        
    	}

        % heuristics 	
    	
        % allocations
        \foreach \ns/\nend/\strat/\v in  {  fs4/fs6/\kspff/6,
                                            fs42/fs44/\kspff/7,
    	                                      fs19/fs21/\kspff/8,
                                            fs23/fs25/\kspff/9,
                                            fs30/fs32/\kspff/10,
                                            fs42/fs44/\kspff/11} {
    
    	\fill[fill=\strat, opacity = 0.5, visible on = <\v>] (\ns.north west)++(0.25*\lw,0) -- ($(\ns.south west)+(0.25*\lw, 0.5*\lw)$) -- ($(\nend.south east) + (-0.25*\lw, 0.5*\lw)$) -- ($(\nend.north east)+(-0.25*\lw,0)$) -- cycle;
    	                        
    	}


        % Text
        \foreach \heurtext/\v in  {   {\textbf{F}irst \textbf{F}it}/6,
    	                               {\textbf{L}ast \textbf{F}it}/7,
                                      {\textbf{B}est \textbf{F}it \textbf{F}irst}/8,
                                      {\textbf{B}est \textbf{F}it \textbf{L}ast}/9,
                                      {\textbf{W}orst \textbf{F}it \textbf{F}irst}/10,
                                      {\textbf{W}orst \textbf{F}it \textbf{L}ast}/11}{

            \node[align = center, visible on = <\v>] at (3, 2.4) {\heurtext};

        }


        % sample block
        \pgfmathtruncatemacro{\amount}{3}
    	\foreach \i in {1,...,\amount}{
    		\pgfmathtruncatemacro{\j}{\i-1}
    		\node[slot, minimum width = \slotwidth, draw = black!20, line width = 0.5*\lw, visible on = <5->] (fse\i) at (\j*\slotwidth+0.125*\lw+5cm, 2.4) {};
    	}
        \fill[fill=\kspff, opacity = 0.5, visible on = <5->] (fse1.north west)++(0.25*\lw,0) -- ($(fse1.south west)+(0.25*\lw, 0.5*\lw)$) -- ($(fse3.south east) + (-0.25*\lw, 0.5*\lw)$) -- ($(fse3.north east)+(-0.25*\lw,0)$) -- cycle;

        % arrows
        \foreach \s/\v in { fs5/6,
                            fs20/8,
                            fs24/9,
                            fs31/10,
                            fs43/11,
                            fs43/7
                            } {
            \draw[-{Stealth[length=2mm, width=1mm]}, line width = 0.5pt, draw = black, visible on = <\v>] ($(fse2.south) + (0, -0.05)$) -- ($(\s.north) + (0, 0.05)$);
        }

        % % FS numbers
        % \node[below = 0mm of fs1, align = center, visible on = <5->] {\tiny $1$};
        % \node[below = 0mm of fs50, align = center, visible on = <5->] {\tiny $50$};
    
    \end{scope}

    % Z1: I I I I _ I _ I I I
    % Z2: W _ W _ _ _ W _ W W
    % Z3: I _ I _ I _ I _ I _
    % Z4: I links
    % Z5: I links (rigged)
 
\end{tikzpicture}
					